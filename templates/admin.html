<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NEXUS - Titan Admin Panel</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@500;600;700&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        body { 
            font-family: 'Rajdhani', sans-serif; 
            background-color: #020617; 
            color: #e2e8f0;
        }
        .glass-card { 
            background: rgba(15, 23, 42, 0.7); 
            backdrop-filter: blur(12px); 
            border: 1px solid rgba(56, 189, 248, 0.1); 
            border-radius: 1rem;
        }
        .tab-btn {
            transition: all 0.3s ease;
        }
        .tab-btn.active {
            background-color: rgba(56, 189, 248, 0.1);
            color: #38bdf8;
            border-left: 4px solid #38bdf8;
        }
        .table-row-hover:hover { background-color: rgba(255, 255, 255, 0.02); }
        .data-font { font-family: 'JetBrains Mono', monospace; }
    </style>
</head>
<body class="flex h-screen overflow-hidden bg-[url('https://www.transparenttextures.com/patterns/stardust.png')]">

    <aside class="w-64 glass-card m-4 flex flex-col justify-between hidden md:flex border-r border-slate-800 relative z-20">
        <div>
            <div class="p-6 text-center border-b border-slate-800/50">
                <h2 class="text-3xl font-bold text-sky-400 tracking-wider">NEXUS SMM</h2>
                <p class="text-xs text-slate-500 uppercase tracking-widest mt-1">Titan Control Panel</p>
            </div>
            <nav class="p-4 space-y-2">
                <button onclick="switchTab('dashboard')" id="btn-dashboard" class="tab-btn active w-full flex items-center gap-3 px-4 py-3 rounded-lg text-slate-400 hover:bg-slate-800/50 hover:text-white font-bold">
                    <i class="fas fa-chart-pie w-5 text-center"></i> Dashboard
                </button>
                <button onclick="switchTab('users')" id="btn-users" class="tab-btn w-full flex items-center gap-3 px-4 py-3 rounded-lg text-slate-400 hover:bg-slate-800/50 hover:text-white font-bold">
                    <i class="fas fa-users w-5 text-center"></i> Manage Users
                </button>
                <button onclick="switchTab('orders')" id="btn-orders" class="tab-btn w-full flex items-center gap-3 px-4 py-3 rounded-lg text-slate-400 hover:bg-slate-800/50 hover:text-white font-bold">
                    <i class="fas fa-shopping-cart w-5 text-center"></i> All Orders
                </button>
                <button onclick="switchTab('tickets')" id="btn-tickets" class="tab-btn w-full flex items-center gap-3 px-4 py-3 rounded-lg text-slate-400 hover:bg-slate-800/50 hover:text-white font-bold">
                    <i class="fas fa-headset w-5 text-center"></i> Support Tickets
                </button>
                <button onclick="switchTab('vouchers')" id="btn-vouchers" class="tab-btn w-full flex items-center gap-3 px-4 py-3 rounded-lg text-slate-400 hover:bg-slate-800/50 hover:text-white font-bold">
                    <i class="fas fa-ticket-alt w-5 text-center"></i> Vouchers
                </button>
                <button onclick="switchTab('settings')" id="btn-settings" class="tab-btn w-full flex items-center gap-3 px-4 py-3 rounded-lg text-slate-400 hover:bg-slate-800/50 hover:text-white font-bold">
                    <i class="fas fa-cog w-5 text-center"></i> App Settings
                </button>
            </nav>
        </div>
        <div class="p-4 border-t border-slate-800/50">
            <a href="/logout" class="block w-full text-center bg-red-500/10 hover:bg-red-500/20 text-red-500 font-bold py-2 px-4 rounded-lg transition-colors border border-red-500/30">
                <i class="fas fa-sign-out-alt mr-2"></i> Lock Panel
            </a>
        </div>
    </aside>

    <main class="flex-1 p-4 md:p-8 overflow-y-auto relative z-10 h-full">
        
        <div id="tab-dashboard" class="tab-content block animate-[fadeIn_0.3s_ease-out]">
            <h2 class="text-2xl font-bold mb-6 text-white border-b border-slate-700 pb-2"><i class="fas fa-satellite-dish text-sky-400 mr-2"></i> System Analytics</h2>
            
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8">
                <div class="glass-card p-6 border-l-4 border-emerald-500 relative overflow-hidden">
                    <i class="fas fa-money-bill-wave absolute -right-4 -bottom-4 text-6xl text-emerald-500/10"></i>
                    <h3 class="text-slate-400 text-sm font-bold uppercase tracking-wider mb-2">Net Profit (Live)</h3>
                    <div class="text-4xl font-bold text-emerald-400 data-font">${{ profit }}</div>
                    <p class="text-xs text-emerald-500/70 mt-2">Calculated from completed orders</p>
                </div>

                <div class="glass-card p-6 border-l-4 border-sky-500 relative overflow-hidden">
                    <i class="fas fa-shopping-bag absolute -right-4 -bottom-4 text-6xl text-sky-500/10"></i>
                    <h3 class="text-slate-400 text-sm font-bold uppercase tracking-wider mb-2">Total Gross Sales</h3>
                    <div class="text-4xl font-bold text-sky-400 data-font">${{ sales }}</div>
                    <p class="text-xs text-sky-500/70 mt-2">Total volume processed</p>
                </div>

                <div class="glass-card p-6 border-l-4 border-purple-500 relative overflow-hidden">
                    <i class="fas fa-server absolute -right-4 -bottom-4 text-6xl text-purple-500/10"></i>
                    <h3 class="text-slate-400 text-sm font-bold uppercase tracking-wider mb-2">Main Panel API Balance</h3>
                    <div class="text-4xl font-bold text-purple-400 data-font">{{ bal }}</div>
                    <p class="text-xs text-purple-500/70 mt-2">Funds left in your provider account</p>
                </div>

                <div class="glass-card p-6 border-l-4 border-amber-500 relative overflow-hidden">
                    <i class="fas fa-users absolute -right-4 -bottom-4 text-6xl text-amber-500/10"></i>
                    <h3 class="text-slate-400 text-sm font-bold uppercase tracking-wider mb-2">Total Registered Users</h3>
                    <div class="text-4xl font-bold text-amber-400 data-font">{{ u_count }}</div>
                </div>

                <div class="glass-card p-6 border-l-4 border-rose-500 relative overflow-hidden">
                    <i class="fas fa-box-open absolute -right-4 -bottom-4 text-6xl text-rose-500/10"></i>
                    <h3 class="text-slate-400 text-sm font-bold uppercase tracking-wider mb-2">Total Processed Orders</h3>
                    <div class="text-4xl font-bold text-rose-400 data-font">{{ o_count }}</div>
                </div>

                <div class="glass-card p-6 border-l-4 border-indigo-500 relative overflow-hidden">
                    <i class="fas fa-heartbeat absolute -right-4 -bottom-4 text-6xl text-indigo-500/10"></i>
                    <h3 class="text-slate-400 text-sm font-bold uppercase tracking-wider mb-2">Bot Status</h3>
                    <div class="text-3xl font-bold mt-1">
                        {% if s.maintenance %}
                            <span class="text-red-500"><i class="fas fa-tools animate-pulse"></i> Maintenance Mode</span>
                        {% else %}
                            <span class="text-green-500"><i class="fas fa-check-circle"></i> Fully Active</span>
                        {% endif %}
                    </div>
                </div>
            </div>
            
            <div class="glass-card p-6 border border-slate-700/50">
                <h3 class="text-lg font-bold text-sky-400 mb-4"><i class="fas fa-bullhorn mr-2"></i> Quick Global Broadcast</h3>
                <form action="/send_broadcast" method="POST" class="flex gap-4">
                    <input type="text" name="msg" placeholder="Write a message to send to all real users..." class="flex-1 bg-slate-900 border border-slate-700 rounded-lg px-4 py-2 text-white focus:outline-none focus:border-sky-500" required>
                    <button type="submit" class="bg-sky-500 hover:bg-sky-400 text-slate-900 font-bold px-6 py-2 rounded-lg transition-colors shadow-[0_0_10px_rgba(56,189,248,0.3)]">
                        <i class="fas fa-paper-plane mr-2"></i> Send
                    </button>
                </form>
            </div>
        </div>

        <div id="tab-users" class="tab-content hidden animate-[fadeIn_0.3s_ease-out]">
            <div class="flex justify-between items-center mb-6 border-b border-slate-700 pb-2">
                <h2 class="text-2xl font-bold text-white"><i class="fas fa-users text-sky-400 mr-2"></i> Manage Users</h2>
                <form action="/add_fake_user" method="POST" class="flex gap-2">
                    <input type="text" name="fake_name" placeholder="Fake Name" required class="bg-slate-900 border border-slate-700 rounded px-3 py-1 text-sm focus:border-sky-500 outline-none">
                    <input type="number" step="0.01" name="fake_spent" placeholder="Spent Amt ($)" required class="bg-slate-900 border border-slate-700 rounded px-3 py-1 text-sm focus:border-sky-500 outline-none w-32">
                    <button type="submit" class="bg-emerald-500 hover:bg-emerald-400 text-slate-900 text-sm font-bold px-4 py-1 rounded transition-colors"><i class="fas fa-plus"></i> Add Fake</button>
                </form>
            </div>
            <div class="glass-card overflow-hidden">
                <div class="overflow-x-auto max-h-[70vh]">
                    <table class="w-full text-left border-collapse">
                        <thead>
                            <tr class="bg-slate-800/80 text-sky-400 text-sm uppercase tracking-wider">
                                <th class="p-4 border-b border-slate-700 font-semibold">User ID</th>
                                <th class="p-4 border-b border-slate-700 font-semibold">Name</th>
                                <th class="p-4 border-b border-slate-700 font-semibold">Bal (USD)</th>
                                <th class="p-4 border-b border-slate-700 font-semibold">Spent (USD)</th>
                                <th class="p-4 border-b border-slate-700 font-semibold">Type</th>
                                <th class="p-4 border-b border-slate-700 font-semibold text-right">Actions</th>
                            </tr>
                        </thead>
                        <tbody class="text-sm divide-y divide-slate-800/50">
                            {% for u in users %}
                            <tr class="table-row-hover transition-colors">
                                <td class="p-4 data-font text-slate-300">{{ u['_id'] }}</td>
                                <td class="p-4 font-bold">{{ u.get('name', 'N/A') }}</td>
                                <td class="p-4 text-green-400 data-font">${{ "%.3f"|format(u.get('balance', 0)) }}</td>
                                <td class="p-4 text-sky-400 data-font">${{ "%.3f"|format(u.get('spent', 0)) }}</td>
                                <td class="p-4">
                                    {% if u.get('is_fake') %}
                                        <span class="bg-purple-500/20 text-purple-400 px-2 py-1 rounded text-xs font-bold border border-purple-500/30">Bot / Fake</span>
                                    {% else %}
                                        <span class="bg-emerald-500/20 text-emerald-400 px-2 py-1 rounded text-xs font-bold border border-emerald-500/30">Real User</span>
                                    {% endif %}
                                </td>
                                <td class="p-4 text-right space-x-2">
                                    {% if not u.get('is_fake') %}
                                        {% if u.get('banned') %}
                                            <a href="/unban_user/{{ u['_id'] }}" class="inline-block bg-emerald-500/10 text-emerald-500 border border-emerald-500/30 hover:bg-emerald-500 hover:text-white px-3 py-1 rounded transition-colors" title="Unban"><i class="fas fa-check"></i></a>
                                        {% else %}
                                            <a href="/ban_user/{{ u['_id'] }}" class="inline-block bg-red-500/10 text-red-500 border border-red-500/30 hover:bg-red-500 hover:text-white px-3 py-1 rounded transition-colors" title="Ban User"><i class="fas fa-ban"></i></a>
                                        {% endif %}
                                    {% endif %}
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <div id="tab-orders" class="tab-content hidden animate-[fadeIn_0.3s_ease-out]">
            <h2 class="text-2xl font-bold mb-6 text-white border-b border-slate-700 pb-2"><i class="fas fa-shopping-cart text-sky-400 mr-2"></i> Recent Orders</h2>
            <div class="glass-card overflow-hidden">
                <div class="overflow-x-auto max-h-[75vh]">
                    <table class="w-full text-left border-collapse">
                        <thead>
                            <tr class="bg-slate-800/80 text-sky-400 text-sm uppercase tracking-wider">
                                <th class="p-4 border-b border-slate-700 font-semibold">Order ID</th>
                                <th class="p-4 border-b border-slate-700 font-semibold">User ID</th>
                                <th class="p-4 border-b border-slate-700 font-semibold">Details</th>
                                <th class="p-4 border-b border-slate-700 font-semibold">Cost</th>
                                <th class="p-4 border-b border-slate-700 font-semibold">Status</th>
                                <th class="p-4 border-b border-slate-700 font-semibold text-right">Action</th>
                            </tr>
                        </thead>
                        <tbody class="text-sm divide-y divide-slate-800/50">
                            {% for o in orders %}
                            <tr class="table-row-hover transition-colors">
                                <td class="p-4 data-font text-slate-300 font-bold">#{{ o['oid'] }}</td>
                                <td class="p-4 data-font text-slate-400">{{ o['uid'] }}</td>
                                <td class="p-4">
                                    <div class="text-xs text-sky-400 font-bold mb-1">SID: {{ o.get('sid', 'N/A') }} | QTY: {{ o.get('qty', 0) }}</div>
                                    <div class="text-xs text-slate-500 truncate max-w-[200px]" title="{{ o.get('link', 'N/A') }}">{{ o.get('link', 'N/A') }}</div>
                                </td>
                                <td class="p-4 text-emerald-400 font-bold data-font">${{ "%.3f"|format(o.get('cost', 0)) }}</td>
                                <td class="p-4">
                                    {% set status = o.get('status', 'pending')|lower %}
                                    {% if status == 'completed' %}
                                        <span class="text-emerald-400 bg-emerald-400/10 px-2 py-1 rounded font-bold text-xs uppercase"><i class="fas fa-check mr-1"></i> Completed</span>
                                    {% elif status in ['canceled', 'refunded', 'fail'] %}
                                        <span class="text-red-400 bg-red-400/10 px-2 py-1 rounded font-bold text-xs uppercase"><i class="fas fa-times mr-1"></i> {{ status }}</span>
                                    {% else %}
                                        <span class="text-amber-400 bg-amber-400/10 px-2 py-1 rounded font-bold text-xs uppercase"><i class="fas fa-spinner fa-spin mr-1"></i> {{ status }}</span>
                                    {% endif %}
                                </td>
                                <td class="p-4 text-right space-x-2">
                                    {% if status not in ['refunded', 'canceled'] %}
                                        <a href="/refund_order/{{ o['oid'] }}" class="inline-block text-xs bg-amber-500/10 text-amber-500 border border-amber-500/30 hover:bg-amber-500 hover:text-slate-900 px-3 py-1 rounded font-bold transition-colors">Refund</a>
                                    {% endif %}
                                    <a href="/delete_order/{{ o['oid'] }}" class="inline-block text-xs bg-red-500/10 text-red-500 border border-red-500/30 hover:bg-red-500 hover:text-white px-3 py-1 rounded font-bold transition-colors"><i class="fas fa-trash"></i></a>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <div id="tab-tickets" class="tab-content hidden animate-[fadeIn_0.3s_ease-out]">
            <h2 class="text-2xl font-bold mb-6 text-white border-b border-slate-700 pb-2"><i class="fas fa-headset text-sky-400 mr-2"></i> Support Tickets</h2>
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                {% for t in tickets %}
                <div class="glass-card p-5 relative border-l-4 {% if t.status == 'open' %}border-amber-500{% else %}border-emerald-500{% endif %}">
                    <div class="flex justify-between items-start mb-3">
                        <div>
                            <span class="text-xs text-slate-500 data-font">UID: {{ t.uid }}</span>
                            <span class="ml-2 text-xs font-bold {% if t.status == 'open' %}text-amber-400 bg-amber-400/10{% else %}text-emerald-400 bg-emerald-400/10{% endif %} px-2 py-0.5 rounded uppercase">{{ t.status }}</span>
                        </div>
                        <a href="/delete_ticket/{{ t['_id'] }}" class="text-slate-500 hover:text-red-500 transition-colors"><i class="fas fa-trash"></i></a>
                    </div>
                    <div class="text-white mb-4 bg-slate-900/50 p-3 rounded border border-slate-700/50">
                        <i class="fas fa-comment-dots text-sky-500/50 mr-2"></i> {{ t.msg }}
                    </div>
                    
                    {% if t.status == 'open' %}
                    <form action="/reply_ticket" method="POST" class="mt-4">
                        <input type="hidden" name="ticket_id" value="{{ t['_id'] }}">
                        <input type="hidden" name="uid" value="{{ t.uid }}">
                        <div class="flex gap-2">
                            <input type="text" name="reply_msg" placeholder="Write reply..." required class="flex-1 bg-slate-900 border border-slate-700 rounded px-3 py-2 text-sm text-white focus:border-sky-500 outline-none">
                            <button type="submit" class="bg-sky-500 hover:bg-sky-400 text-slate-900 font-bold px-4 py-2 rounded text-sm transition-colors"><i class="fas fa-reply mr-1"></i> Reply</button>
                        </div>
                    </form>
                    {% else %}
                    <div class="mt-4 bg-emerald-500/5 border border-emerald-500/20 p-3 rounded text-sm text-emerald-400">
                        <i class="fas fa-reply mr-2"></i> <strong>Admin Replied:</strong> {{ t.get('reply', 'N/A') }}
                    </div>
                    {% endif %}
                </div>
                {% endfor %}
                {% if not tickets %}
                <div class="col-span-full text-center text-slate-500 py-10">
                    <i class="fas fa-inbox text-4xl mb-3 opacity-50"></i>
                    <p>No support tickets available.</p>
                </div>
                {% endif %}
            </div>
        </div>

        <div id="tab-vouchers" class="tab-content hidden animate-[fadeIn_0.3s_ease-out]">
            <h2 class="text-2xl font-bold mb-6 text-white border-b border-slate-700 pb-2"><i class="fas fa-ticket-alt text-sky-400 mr-2"></i> Promo Vouchers</h2>
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                <div class="glass-card p-6 lg:col-span-1 border-t-4 border-sky-500">
                    <h3 class="text-lg font-bold text-sky-400 mb-4"><i class="fas fa-plus-circle mr-2"></i> Create New Voucher</h3>
                    <form action="/create_voucher" method="POST" class="space-y-4">
                        <div>
                            <label class="block text-xs text-slate-400 font-bold mb-1 uppercase tracking-wide">Voucher Code</label>
                            <input type="text" name="code" placeholder="e.g. FREE50" required class="w-full bg-slate-900 border border-slate-700 rounded px-4 py-2 text-white focus:border-sky-500 outline-none uppercase font-bold tracking-widest">
                        </div>
                        <div>
                            <label class="block text-xs text-slate-400 font-bold mb-1 uppercase tracking-wide">Amount (USD)</label>
                            <input type="number" step="0.01" name="amount" placeholder="0.50" required class="w-full bg-slate-900 border border-slate-700 rounded px-4 py-2 text-white focus:border-sky-500 outline-none data-font">
                        </div>
                        <div>
                            <label class="block text-xs text-slate-400 font-bold mb-1 uppercase tracking-wide">Usage Limit</label>
                            <input type="number" name="limit" placeholder="10" required class="w-full bg-slate-900 border border-slate-700 rounded px-4 py-2 text-white focus:border-sky-500 outline-none data-font">
                        </div>
                        <button type="submit" class="w-full bg-sky-500 hover:bg-sky-400 text-slate-900 font-bold py-2 rounded transition-colors shadow-[0_0_10px_rgba(56,189,248,0.3)]">Generate Voucher</button>
                    </form>
                </div>
                
                <div class="lg:col-span-2 space-y-4">
                    {% for v in vouchers %}
                    <div class="glass-card p-4 flex justify-between items-center border-l-4 {% if v.used_by|length >= v.limit %}border-red-500 opacity-50{% else %}border-emerald-500{% endif %}">
                        <div>
                            <div class="text-xl font-bold text-white tracking-widest">{{ v.code }}</div>
                            <div class="text-sm text-slate-400 mt-1">Reward: <span class="text-emerald-400 font-bold">${{ v.amount }}</span></div>
                        </div>
                        <div class="text-right">
                            <div class="text-sm font-bold bg-slate-900 px-3 py-1 rounded border border-slate-700">
                                <span class="{% if v.used_by|length >= v.limit %}text-red-400{% else %}text-sky-400{% endif %}">{{ v.used_by|length }}</span> / {{ v.limit }} Used
                            </div>
                            {% if v.used_by|length >= v.limit %}
                                <div class="text-xs text-red-500 font-bold uppercase mt-2"><i class="fas fa-ban"></i> Exhausted</div>
                            {% else %}
                                <div class="text-xs text-emerald-500 font-bold uppercase mt-2"><i class="fas fa-check-circle"></i> Active</div>
                            {% endif %}
                        </div>
                    </div>
                    {% endfor %}
                    {% if not vouchers %}
                        <div class="text-center text-slate-500 py-10 glass-card">No vouchers generated yet.</div>
                    {% endif %}
                </div>
            </div>
        </div>

        <div id="tab-settings" class="tab-content hidden animate-[fadeIn_0.3s_ease-out]">
            <h2 class="text-2xl font-bold mb-6 text-white border-b border-slate-700 pb-2"><i class="fas fa-cogs text-sky-400 mr-2"></i> Application Settings</h2>
            
            <form action="/settings" method="POST" class="space-y-6 max-w-4xl">
                <div class="glass-card p-6 border-t-4 border-indigo-500">
                    <h3 class="text-lg font-bold text-white mb-4"><i class="fas fa-sliders-h mr-2 text-indigo-400"></i> Core Configurations</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-sm text-slate-400 font-bold mb-2 uppercase tracking-wide">Profit Margin (%)</label>
                            <div class="flex items-center">
                                <input type="number" step="0.1" name="profit_margin" value="{{ s.get('profit_margin', 20.0) }}" class="w-full bg-slate-900 border border-slate-700 rounded-l-lg px-4 py-3 text-white focus:border-indigo-500 outline-none data-font text-lg">
                                <div class="bg-slate-800 border border-l-0 border-slate-700 px-4 py-3 rounded-r-lg text-slate-400 font-bold">%</div>
                            </div>
                            <p class="text-xs text-slate-500 mt-2">Added directly to API base prices.</p>
                        </div>
                        
                        <div>
                            <label class="block text-sm text-slate-400 font-bold mb-2 uppercase tracking-wide">Force Sub Channels</label>
                            <input type="text" name="channels" value="{{ s.get('channels', []) | join(', ') }}" placeholder="@Channel1, @Channel2" class="w-full bg-slate-900 border border-slate-700 rounded-lg px-4 py-3 text-white focus:border-indigo-500 outline-none data-font">
                            <p class="text-xs text-slate-500 mt-2">Comma separated usernames (e.g. @NexusUpdates).</p>
                        </div>
                        
                        <div class="col-span-full bg-slate-900/50 p-4 rounded border border-slate-700 flex items-center justify-between">
                            <div>
                                <label class="text-white font-bold text-lg cursor-pointer flex items-center gap-2">
                                    <i class="fas fa-tools text-red-400"></i> Maintenance Mode
                                </label>
                                <p class="text-xs text-slate-500">Enable to lock out regular users during upgrades.</p>
                            </div>
                            <label class="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" name="maintenance" class="sr-only peer" {% if s.get('maintenance') %}checked{% endif %}>
                                <div class="w-14 h-7 bg-slate-700 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-6 after:w-6 after:transition-all peer-checked:bg-red-500"></div>
                            </label>
                        </div>
                    </div>
                </div>

                <div class="glass-card p-6 border-t-4 border-emerald-500">
                    <h3 class="text-lg font-bold text-white mb-4"><i class="fas fa-wallet mr-2 text-emerald-400"></i> Payment Gateways (Fiat & Crypto)</h3>
                    <div id="payment-methods" class="space-y-3">
                        {% for p in s.get('payments', []) %}
                        <div class="flex gap-3 payment-row bg-slate-900/50 p-2 rounded border border-slate-700/50">
                            <div class="flex-1">
                                <label class="text-xs text-slate-500 font-bold uppercase ml-1">Method Name</label>
                                <input type="text" name="pay_name[]" value="{{ p.name }}" placeholder="e.g. Bkash / Binance" class="w-full bg-slate-900 border border-slate-700 rounded px-3 py-2 text-white focus:border-emerald-500 outline-none">
                            </div>
                            <div class="w-1/3">
                                <label class="text-xs text-slate-500 font-bold uppercase ml-1">Rate (Per $1)</label>
                                <input type="number" step="0.01" name="pay_rate[]" value="{{ p.rate }}" placeholder="e.g. 120 or 1" class="w-full bg-slate-900 border border-slate-700 rounded px-3 py-2 text-white focus:border-emerald-500 outline-none data-font">
                            </div>
                            <div class="w-auto flex items-end pb-1">
                                <button type="button" onclick="this.parentElement.parentElement.remove()" class="text-slate-500 hover:text-red-500 p-2 transition-colors"><i class="fas fa-times-circle text-xl"></i></button>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                    
                    <div class="mt-4 p-3 bg-sky-500/10 border border-sky-500/20 rounded text-xs text-sky-400">
                        <i class="fas fa-info-circle mr-1"></i> <strong>Pro Tip for Crypto:</strong> Name it "Binance Pay" and set rate to "1" to collect exact USD amount. Set Bkash/Nagad rate to "120".
                    </div>
                    
                    <button type="button" onclick="addPaymentRow()" class="mt-4 bg-slate-800 hover:bg-slate-700 text-slate-300 font-bold px-4 py-2 rounded text-sm transition-colors border border-slate-600"><i class="fas fa-plus mr-1"></i> Add Gateway</button>
                </div>

                <div class="flex justify-end pt-4">
                    <button type="submit" class="bg-indigo-500 hover:bg-indigo-400 text-white font-bold px-8 py-3 rounded-lg transition-all shadow-[0_0_15px_rgba(99,102,241,0.4)] text-lg">
                        <i class="fas fa-save mr-2"></i> Save All Changes
                    </button>
                </div>
            </form>
        </div>

    </main>

    <script>
        // Tab Switching Logic
        function switchTab(tabId) {
            document.querySelectorAll('.tab-content').forEach(el => el.classList.add('hidden'));
            document.querySelectorAll('.tab-btn').forEach(el => el.classList.remove('active', 'border-l-4'));
            
            document.getElementById('tab-' + tabId).classList.remove('hidden');
            document.getElementById('btn-' + tabId).classList.add('active');
        }

        // Dynamic Payment Method Rows
        function addPaymentRow() {
            const container = document.getElementById('payment-methods');
            const row = document.createElement('div');
            row.className = 'flex gap-3 payment-row bg-slate-900/50 p-2 rounded border border-slate-700/50 animate-[fadeIn_0.2s_ease-out]';
            row.innerHTML = `
                <div class="flex-1">
                    <label class="text-xs text-slate-500 font-bold uppercase ml-1">Method Name</label>
                    <input type="text" name="pay_name[]" placeholder="e.g. USDT TRC20" class="w-full bg-slate-900 border border-slate-700 rounded px-3 py-2 text-white focus:border-emerald-500 outline-none" required>
                </div>
                <div class="w-1/3">
                    <label class="text-xs text-slate-500 font-bold uppercase ml-1">Rate (Per $1)</label>
                    <input type="number" step="0.01" name="pay_rate[]" placeholder="e.g. 1" class="w-full bg-slate-900 border border-slate-700 rounded px-3 py-2 text-white focus:border-emerald-500 outline-none data-font" required>
                </div>
                <div class="w-auto flex items-end pb-1">
                    <button type="button" onclick="this.parentElement.parentElement.remove()" class="text-slate-500 hover:text-red-500 p-2 transition-colors"><i class="fas fa-times-circle text-xl"></i></button>
                </div>
            `;
            container.appendChild(row);
        }
    </script>
</body>
</html>
